# image-updater-values.yaml
# –û–±—â–∏–µ RBAC/SA-–Ω–∞—Å—Ç—Ä–æ–π–∫–∏
serviceAccount:
  create: true
rbac:
  enabled: true

# –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏
extraArgs:
  - --interval=1m

# –î–µ—Ç–∞–ª—å–Ω—ã–π –ª–æ–≥
config:
  logLevel: debug
  # –û–ø–∏—Å–∞–Ω–∏–µ registry
  registries:
    # registry –¥–ª—è –∫–æ–º–∞–Ω–¥—ã zeon-ai
    - name: zeon-ai-game-bot-registry
      prefix: gitlab-registry.project.client.loc/zeon-ai/backend/game-bot
      api_url: https://gitlab.project.client.loc
      credentials: pullsecret:argocd/image-updater-gitlab-deploy-token-game-bot
      insecure: false

    # –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –≤—Ç–æ—Ä–æ–π –∫–æ–º–∞–Ω–¥—ã (–ø—Ä–∏–º–µ—Ä –¥–ª—è team2)
    - name: team2-registry
      prefix: gitlab-registry.project.client.loc/team2
      api_url: https://gitlab.project.client.loc
      credentials: pullsecret:argocd/image-updater-gitlab-deploy-token-team2
      insecure: false

  # –®–∞–±–ª–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ–º–º–∏—Ç–∞
  gitCommitTemplate: |-
    build: üöÄ update {{.AppName}} to {{(index .AppChanges 0).NewTag}}

    ## üìã Image Update Summary
    **Application:** {{ .AppName }}
    **Updated Images:** {{ len .AppChanges }}

    ## üîÑ Changes Details
    {{ range .AppChanges -}}
    **Registry:** {{ .Image }}
    **Previous:** `{{ .OldTag }}`
    **New:** `{{ .NewTag }}`
    {{ end -}}

# –ü—Ä–æ—Å—Ç–æ–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CA —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
volumes:
  - name: root-ca
    configMap:
      name: root-ca-cert

volumeMounts:
  - name: root-ca
    mountPath: /usr/local/share/ca-certificates/project-client-root.crt
    subPath: project-client-root.crt
    readOnly: true

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è CA
extraEnv:
  - name: SSL_CERT_FILE
    value: /usr/local/share/ca-certificates/project-client-root.crt
  - name: REQUESTS_CA_BUNDLE
    value: /usr/local/share/ca-certificates/project-client-root.crt
  - name: CURL_CA_BUNDLE
    value: /usr/local/share/ca-certificates/project-client-root.crt
  - name: GIT_SSL_CAINFO
    value: /usr/local/share/ca-certificates/project-client-root.crt
  - name: GIT_SSL_CAPATH
    value: /usr/local/share/ca-certificates/
