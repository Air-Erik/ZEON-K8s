# image-updater-values.yaml

# Общие RBAC/SA-настройки
serviceAccount:
  create: true
rbac:
  create: true

# Интервал проверки
extraArgs:
  - --interval=1m

# Детальный лог
config:
  log.level: debug

  # Описание registry
  registries.conf: |
    registries:
    - name: gitlab-registry
      prefix: gitlab-registry.project.client.loc
      api_url: https://gitlab-registry.project.client.loc
      credentials: pullsecret:argocd/image-updater-gitlab-deploy-token-game-bot
      insecure: false

# ===== Всё, что связано с монтированием CA и env, идёт внутрь deployment: =====
deployment:
  # 1) Монтируем ConfigMap с вашим self-signed CA
  extraVolumes:
    - name: root-ca
      configMap:
        name: root-ca-cert
        items:
          - key: project-client-root.crt
            path: project-client-root.crt

  extraVolumeMounts:
    - name: root-ca
      mountPath: /etc/ssl/certs/project-client-root.crt
      subPath: project-client-root.crt
      readOnly: true

  # 2) Пробрасываем переменные окружения
  extraEnv:
    - name: SSL_CERT_FILE
      value: /etc/ssl/certs/project-client-root.crt
    - name: GIT_SSL_CAINFO
      value: /etc/ssl/certs/project-client-root.crt
# ================================================================================
